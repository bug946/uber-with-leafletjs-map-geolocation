<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <title>Geolocalização</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .leaflet-marker-icon,
        .leaflet-marker-shadow {
            display: none !important;
        }

        .pointers,
        .taxi-pointers {
            display: block !important;
        }
    </style>

</head>

<body>
    <div id="map" style="width:100%; height: 100vh"></div>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

    <script>
        // Personalizar css no mapa
        let myCustomColourUser = 'background-color: red;';
        const markerHtml = `
			width: 3rem;
			height: 3rem;
			display: block;
			left: -1.5rem;
			top: -1.5rem;
			position: relative;
			border-radius: 3rem 3rem 0;
			transform: rotate(45deg);
			border: 3px solid #FFFFFF;`

        // Coordenadas do Ponto A - Táxi
        const coordTaxi = [-20.192786, -50.925093]; // Coordenadas iniciais do táxi
        // Coordenadas do Ponto B - Usuário
        const coordUser = [-20.202533, -50.927947]; // Destino final do táxi (usuário)

        // Iniciar o mapa com coordenadas do ponto A
        const map = L.map('map').setView(coordTaxi, 15);

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

        // Personalizar ícone do táxi
        const taxiIcon = L.icon({
            className: "taxi-pointers",
            iconUrl: 'taxi.png', // Certifique-se que o caminho para o ícone está correto
            iconSize: [45, 45]
        });
        const marker = L.marker(coordTaxi, { icon: taxiIcon }).addTo(map);

        function startService() {
            // Array de coordenadas simulando o trajeto do táxi até o cliente
            const latlng = [
                { lat: -20.192786, lng: -50.925093 }, // Ponto inicial (táxi)
                { lat: -20.193834, lng: -50.925179 },
                { lat: -20.194619, lng: -50.925307 },
                { lat: -20.195747, lng: -50.925393 },
                { lat: -20.196431, lng: -50.925479 },
                { lat: -20.197076, lng: -50.925586 },
                { lat: -20.197962, lng: -50.925694 },
                { lat: -20.198788, lng: -50.925779 },
                { lat: -20.199915, lng: -50.925887 },
                { lat: -20.200821, lng: -50.926058 },
                { lat: -20.201728, lng: -50.926144 },
                { lat: -20.202775, lng: -50.926252 },
                { lat: -20.202654, lng: -50.927045 },
                { lat: -20.202533, lng: -50.927947 }  // Destino final (usuário)
            ];

            // Adiciona marcador personalizado para o usuário
            const userIcon = L.divIcon({
                className: "pointers",
                iconAnchor: [0, 24],
                labelAnchor: [-6, 0],
                popupAnchor: [0, -36],
                html: `<span style="${markerHtml}${myCustomColourUser}" />`
            });
            L.marker(coordUser, { icon: userIcon }).addTo(map);

            // Configura o controle de rota e as instruções em português
            L.Routing.control({
                waypoints: latlng.map(point => L.latLng(point.lat, point.lng)),
                language: 'pt-BR', // Configuração de linguagem para Português
                lineOptions: {
                    styles: [{ color: 'red', opacity: 1, weight: 5 }] // Linha da rota em vermelho vívido
                }
            }).on('routesfound', function (e) {
                latlng.forEach(function (coord, index) {
                    setTimeout(function () {
                        marker.setLatLng([coord.lat, coord.lng]);
                        if (coord.lat === coordUser[0] && coord.lng === coordUser[1]) {
                            alert('Seu táxi chegou ao destino!');
                        }
                    }, 1000 * index); // A cada segundo, atualiza a posição do táxi no mapa
                });
            }).addTo(map);
        };

        startService(); // Inicia o serviço ao carregar a página
    </script>
</body>

</html>

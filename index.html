<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <title>Geolocalização</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .leaflet-marker-icon,
        .leaflet-marker-shadow {
            display: none !important;
        }

        .pointers,
        .guincho-pointers {
            display: block !important;
        }
    </style>

</head>

<body>
    <div id="map" style="width:100%; height: 100vh"></div>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

    <script>
        // Personalizar css no mapa
        let myCustomColourUser = 'background-color: red;';
        const markerHtml = `
			width: 3rem;
			height: 3rem;
			display: block;
			left: -1.5rem;
			top: -1.5rem;
			position: relative;
			border-radius: 3rem 3rem 0;
			transform: rotate(45deg);
			border: 3px solid #FFFFFF;`

        // Coordenadas do Ponto A - Guincho
        const coordGuincho = [-20.188947, -50.934689]; // Coordenadas iniciais do guincho
        // Coordenadas do Ponto B - Usuário
        const coordUser = [-20.194385, -50.915141]; // Destino final do guincho (usuário)

        // Iniciar o mapa com coordenadas do ponto A
        const map = L.map('map').setView(coordGuincho, 15);

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

        // Personalizar ícone do guincho
        const guinchoIcon = L.icon({
            className: "guincho-pointers",
            iconUrl: 'Guincho.png', // Certifique-se de ter o ícone Guincho.png no diretório correto
            iconSize: [45, 45]
        });
        const marker = L.marker(coordGuincho, { icon: guinchoIcon }).addTo(map);

        function startService() {
            // Array de coordenadas simulando o trajeto do guincho até o cliente
            const latlng = [
                { lat: -20.188947, lng: -50.934689 }, // Ponto inicial (guincho)
                { lat: -20.188987, lng: -50.933649 },
                { lat: -20.189279, lng: -50.932200 },
                { lat: -20.189843, lng: -50.929421 },
                { lat: -20.190558, lng: -50.926331 },
                { lat: -20.191283, lng: -50.925119 },
                { lat: -20.191173, lng: -50.924282 },
                { lat: -20.191938, lng: -50.922222 },
                { lat: -20.192220, lng: -50.920903 },
                { lat: -20.192774, lng: -50.919250 },
                { lat: -20.193499, lng: -50.917351 },
                { lat: -20.194244, lng: -50.915581 },
                { lat: -20.194385, lng: -50.915141 }  // Destino final (usuário)
            ];

            // Adiciona marcador personalizado para o usuário
            const userIcon = L.divIcon({
                className: "pointers",
                iconAnchor: [0, 24],
                labelAnchor: [-6, 0],
                popupAnchor: [0, -36],
                html: `<span style="${markerHtml}${myCustomColourUser}" />`
            });
            L.marker(coordUser, { icon: userIcon }).addTo(map);

            // Configura o controle de rota e as instruções em português
            L.Routing.control({
                waypoints: latlng.map(point => L.latLng(point.lat, point.lng)),
                language: 'pt-BR', // Configuração de linguagem para Português
                lineOptions: {
                    styles: [{ color: 'red', opacity: 1, weight: 5 }] // Linha da rota em vermelho vívido
                }
            }).on('routesfound', function (e) {
                latlng.forEach(function (coord, index) {
                    setTimeout(function () {
                        marker.setLatLng([coord.lat, coord.lng]);
                        if (coord.lat === coordUser[0] && coord.lng === coordUser[1]) {
                            alert('O guincho chegou ao destino!');
                        }
                    }, 1000 * index); // A cada segundo, atualiza a posição do guincho no mapa
                });
            }).addTo(map);
        };

        startService(); // Inicia o serviço ao carregar a página
    </script>
</body>

</html>
